{% load staticfiles i18n cropping data_helpers %}

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

    <link rel="stylesheet"
      href="{% static 'css/alsijil/full_register.css' %}" />
  </head>

  <body class="A4">
    <section class="sheet padding-10mm bigprint" id="titlepage">
      <div>
        <h1>{% trans 'Class register' %}</h1>
        <img src="{% cropped_thumbnail group.school 'logo_cropping' max_size='600x600' %}" id="school-logo" />
        <p id="group-desc">
          {{ group.name }}
        </p>
        <p id="group-owners">
          {% trans 'Owners' %}:
          {{ group.owners.all|join:', ' }}
        </p>
        <p id="printed-info">
          {% trans 'Printed on' %} {{ today }}
        </p>
      </div>
      <div>
        <hr />
      </div>
      <div>
        <p>
          {% blocktrans %}
            This printout is intended for archival purposes. The main copy of
            the class register is stored in the BiscuIT School Information
            System.
          {% endblocktrans %}
        </p>
        <p>
          {% blocktrans %}
            Copies of the class register, both digital and as printout, must
            only be kept inside the school and/or on devices authorised by the
            school.
          {% endblocktrans %}
        </p>
        <p>
          {% blocktrans %}
            The owner of the group and the headteacher confirm the above, as
            well as the correctness of this printout.
          {% endblocktrans %}
        </p>
        <p id="signatures">
          <span class="signature-line"></span> ({% trans 'Owners' %}),
          <span class="signature-line"></span> ({% trans 'Headteacher' %})
        </p>
      </div>
    </section>

    <section class="sheet padding-10mm" id="persons-overview">
      <h2>{% trans 'Persons in group' %} {{ group.name }}</h2>

      <table id="persons">
        <thead>
          <tr>
            <th>{% trans 'No.' %}</th>
            <th>{% trans 'Last name' %}</th>
            <th>{% trans 'First name' %}</th>
            <th>{% trans 'Sex' %}</th>
            <th>{% trans 'Date of birth' %}</th>
          </tr>
        </thead>

        <tbody>
          {% for person in group.members.all %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ person.last_name }}</td>
              <td>{{ person.first_name }}</td>
              <td>{{ person.get_sex_display }}</td>
              <td>{{ person.date_of_birth }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    <section class="sheet padding-10mm" id="lessons-overview">
      <h2>{% trans 'Teachers and lessons in group' %} {{ group.name }}</h2>

      <table id="lessons">
        <thead>
          <tr>
            <th>{% trans 'Subject' %}</th>
            <th>{% trans 'Teacher' %}</th>
            <th>{% trans 'Lesson start' %}</th>
            <th>{% trans 'Lesson end' %}</th>
            <th>{% trans 'Per week' %}</th>
          </tr>
        </thead>

        <tbody>
          {% for lesson in group.lessons.all %}
            <tr>
              <td>{{ lesson.subject.name }}</td>
              <td>{{ lesson.teachers.all|join:', ' }}</td>
              <td>{{ lesson.date_start }}</td>
              <td>{{ lesson.date_end }}</td>
              <td>{{ lesson.lesson_periods.count }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>

    {% for week in weeks %}
      <section class="sheet padding-10mm smallprint">
        <h2>{% trans 'Lesson documentation for calendar week' %} {{ week.week }}</h2>

        <table>
          <thead>
            <tr>
              <th></th>
              <th>{% trans 'Pe.' %}</th>
              <th>{% trans 'Subj.' %}</th>
              <th>{% trans 'Subs.' %}</th>
              <th>{% trans 'Lesson topic' %}</th>
              <th>{% trans 'Homework' %}</th>
              <th>{% trans 'Notes' %}</th>
              <th>{% trans 'Te.' %}</th>
            </tr>
          </thead>
          <tbody>
            {% for day in week %}
              {% with periods_by_day|get_dict:day as periods %}
                {% for period, documentations, notes, substitution in periods %}
                  <tr class="
                    {% if substitution %}
                      {% if substitution.cancelled %}
                        lesson-cancelled
                      {% else %}
                        lesson-substituted
                      {% endif %}
                    {% endif %}
                    {% if forloop.first %}
                      lessons-day-first
                    {% endif %}
                  ">
                    {% if forloop.first %}
                      <th rowspan="{{ periods|length }}" class="lessons-day-head">{{ day }}</th>
                    {% endif %}
                    <td class="lesson-pe">{{ period.period.period }}</td>
                    <td class="lesson-subj">{{ period.lesson.subject.abbrev }}</td>
                    <td class="lesson-subs">{{ substitution.subject.abbrev }}</td>
                    <td class="lesson-topic">
                      {% if substitution.cancelled %}
                        {% trans 'Lesson cancelled' %}
                      {% else %}
                        {{ documentations.0.topic }}
                      {% endif %}
                    </td>
                    <td class="lesson-homework">{{ documentations.0.homework }}</td>
                    <td class="lesson-notes">
                      {% for note in notes %}
                        {% if note.absent %}
                          <span class="lesson-note-absent">
                            {{ note.person.last_name }}, {{ note.person.first_name|slice:"0:1" }}.
                            {% if note.excused %}
                              <span class="lesson-note-excused">
                               ({% trans 'e' %})
                              </span>
                            {% endif %}
                        {% endif %}
                        {% if note.late %}
                          <span class="lesson-note-late">
                            {{ note.person.last_name }}, {{ note.person.first_name|slice:"0:1" }}.
                            ({{ note.late }}â€²)
                            {% if note.excused %}
                              <span class="lesson-note-excused">
                               ({% trans 'e' %})
                              </span>
                            {% endif %}
                        {% endif %}
                      {% endfor %}
                    </td>
                    <td class="lesson-te">
                      {% if documentations.0.topic %}
                        {{ substitution.teachers.first.short_name|default:period.lesson.teachers.first.short_name }}
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              {% endwith %}
            {% endfor %}
          </tbody>
        </table>
      </section>
    {% endfor %}
  </body>
</html>
