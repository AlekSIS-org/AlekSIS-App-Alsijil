{# -*- engine:django -*- #}

{% extends "core/base.html" %}
{% load material_form i18n week_helpers %}

{% block browser_title %}{% blocktrans %}Week view{% endblocktrans %}{% endblock %}

{% block content %}
 <div class="row">
  <div class="col s10">
    <form method="get">
      <ul id="timetable_select_form">
        {% form form=select_form %}{% endform %}
      </ul>
      <button type="submit" class="btn waves-effect waves-light">
        {% blocktrans %}Select{% endblocktrans %}
      </button>
    </form>
  </div>
  {% if group %}
    <div class="col s2">
      <a class="btn waves-light" href="{% url 'full_register_group' group.id %}">
        <i class="material-icons">printer</i>
      </a>
    </div>
  {% endif %}
 </div>

  {% if lesson_periods.count %}
    <div class="row">
      <div class="col s7">
        {% regroup lesson_periods by period.get_weekday_display as periods_by_day %}
        {% for weekday, periods in periods_by_day %}
          <div class="card">
            <div class="card-content">
              <span class="card-title">
                {{ weekday }}
              </span>
              <table class="striped responsive-table">
                <thead>
                  <tr>
                    <th>{% blocktrans %}Period{% endblocktrans %}</th>
                    <th>{% blocktrans %}Subject{% endblocktrans %}</th>
                    <th>{% blocktrans %}Teachers{% endblocktrans %}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for period in periods %}
                    <tr class="
                      {% if period.has_documentation %}
                        success
                      {% else %}
                        {% weekday_to_date week period.period.weekday as current_date %}
                        {% today as today %}
                        {% if current_date < today %}
                          error
                        {% else %}
                          {% if period.get_substitution %}
                            warning
                            {% if period.get_substitution.cancelled %}
                              alsijil-lesson-cancelled
                            {% endif %}
                          {% endif %}
                        {% endif %}
                      {% endif %}
                    ">
                      <td>{{ period.period.period }}</td>
                      <td>
                        <a href="{% url 'lesson_by_week_and_period' week.year week.week period.id %}">
                          {{ period.get_subject.name }}
                        </a>
                      </td>
                      <td>{{ period.get_teacher_names }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        {% endfor %}
      </div>
      <div class="col s5">
        <div class="card">
          <div class="card-content">
            <span class="card-title">
              {% blocktrans %}Personal notes{% endblocktrans %}
            </span>
            {% for person in persons %}
              <h5 class="card-title">{{ person.full_name }}</h5>
              <p class="card-text">
                {% trans "Absent" %}: {{ person.absences }}
                ({{ person.unexcused }} {% trans "unexcused" %})
              </p>
              <p class="card-text">
                {% trans "Summed up tardiness" %}: {{ person.tardiness }}
              </p>
              {% for note in person.personal_notes|only_week:week %}
                {% if note.remarks %}
                  <blockquote class="blockquote mb-0">
                    {{ note.remarks }}
                    <footer class="blockquote-footer">
                      {% weekday_to_date week note.lesson_period.period.weekday as note_date %}
                      {{ note_date }}, {{ note.lesson_period.lesson.subject.name }}
                    </footer>
                  </blockquote>
                {% endif %}
              {% endfor %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="card red darken-1">
      <div class="card-content white-text">
        <span class="card-title">
          {% blocktrans %}No group selected{% endblocktrans %}
        </span>
        <p>
          {% blocktrans %}
            There are no lessons for the selected group, teacher, room or time.
          {% endblocktrans %}
        </p>
      </div>
    </div>
  {% endif %}
{% endblock %}
